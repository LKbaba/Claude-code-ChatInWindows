# Claude Code ChatUI 3.0.x å‡çº§ PRD

> **ç‰ˆæœ¬**: 3.0.3
> **æ—¥æœŸ**: 2026-01-11
> **çŠ¶æ€**: è¿›è¡Œä¸­
> **ä½œè€…**: LK & Claude

---

# ç¬¬ä¸€éƒ¨åˆ†ï¼šå¾…è§£å†³çš„é—®é¢˜

---

## é—®é¢˜ 1ï¼šè¾“å…¥åé»„ç¯å˜ç»¿ç¯ä½†æ— è¾“å‡ºï¼ˆå¾…è§‚å¯Ÿï¼‰â­

### é—®é¢˜æè¿°
- è¾“å…¥æç¤ºè¯åï¼Œå·¦ä¸‹è§’ä¼šå˜æˆé»„ç¯ï¼ˆè¡¨ç¤ºå·¥ä½œä¸­ï¼‰
- è¿‡ä¸€ä¼šå°±å˜æˆç»¿ç¯äº†ï¼Œæ²¡æœ‰ä»»ä½•è¾“å‡º
- éœ€è¦é‡æ–°è¾“å…¥æç¤ºè¯æ‰èƒ½å·¥ä½œ

### æˆªå›¾è¯æ®
![é—®é¢˜æˆªå›¾](CCimages/pasted-image-2026-01-10_15-21-53-264.png)

### çŠ¶æ€
**æŒç»­è§‚å¯Ÿä¸­** - ç­‰åˆ°å†æ¬¡é‡åˆ°æ­¤é—®é¢˜æ—¶ï¼Œé€šè¿‡ debug_log.txt åˆ†æå…·ä½“åŸå› ã€‚

### å·²åˆ†æçš„å¯èƒ½åŸå› 

1. **è¿›ç¨‹æ­£å¸¸é€€å‡ºä½†æ²¡æœ‰è¾“å‡º**ï¼šè¿›ç¨‹ä»¥ code=0 é€€å‡ºä½†æ—  stdout
2. **ç¼ºå°‘è¶…æ—¶æœºåˆ¶**ï¼šå¦‚æœ CLI å¡ä½ï¼Œè¿›ç¨‹ä¼šä¸€ç›´è¿è¡Œ
3. **é”™è¯¯å¤„ç†ä¸å®Œå–„**ï¼šæŸäº›é”™è¯¯æƒ…å†µæ²¡æœ‰å‘ç”¨æˆ·æ˜¾ç¤º
4. **MessageProcessor è§£æå¤±è´¥**ï¼šJSON è§£æé”™è¯¯å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±

### è°ƒè¯•å»ºè®®

ä¸‹æ¬¡é‡åˆ°æ­¤é—®é¢˜æ—¶ï¼Œæ£€æŸ¥ debug_log.txt ä¸­ï¼š
1. æ˜¯å¦æœ‰ `[ClaudeProcessService] Spawning Claude` æ—¥å¿—ï¼ˆè¿›ç¨‹æ˜¯å¦å¯åŠ¨ï¼‰
2. æ˜¯å¦æœ‰ `[MessageProcessor] Received JSON` æ—¥å¿—ï¼ˆæ˜¯å¦æ”¶åˆ°å“åº”ï¼‰
3. æ˜¯å¦æœ‰ `onClose` å›è°ƒçš„æ—¥å¿—ï¼ˆè¿›ç¨‹å¦‚ä½•é€€å‡ºï¼‰
4. æ˜¯å¦æœ‰ä»»ä½•é”™è¯¯æˆ–å¼‚å¸¸æ—¥å¿—

### å¯èƒ½çš„ä¿®å¤æ–¹å‘

1. **æ·»åŠ è¿›ç¨‹è¶…æ—¶æœºåˆ¶**ï¼šå¦‚æœ N ç§’å†…æ²¡æœ‰æ”¶åˆ°ä»»ä½•è¾“å‡ºï¼Œæ˜¾ç¤ºè¶…æ—¶æç¤º
2. **æ·»åŠ è¿›ç¨‹çŠ¶æ€ç›‘æ§**ï¼šåœ¨ `onClose` å›è°ƒä¸­æ£€æŸ¥æ˜¯å¦æœ‰è¾“å‡ºï¼Œå¦‚æœæ²¡æœ‰åˆ™æ˜¾ç¤ºè­¦å‘Š
3. **å¢å¼ºé”™è¯¯æ—¥å¿—**ï¼šåœ¨å…³é”®èŠ‚ç‚¹æ·»åŠ æ›´å¤šè°ƒè¯•æ—¥å¿—

---

# ç¬¬äºŒéƒ¨åˆ†ï¼šåŠŸèƒ½å‡çº§è®¡åˆ’

---

## 1. å‡çº§èƒŒæ™¯

### 1.1 ä¸ºä»€ä¹ˆè¦å‡çº§ï¼Ÿ

Claude Code CLI åœ¨ 2.1.1 å’Œ 2.1.2 ç‰ˆæœ¬ä¸­è¿›è¡Œäº†é‡å¤§æ›´æ–°ï¼Œå¼•å…¥äº†å¤šä¸ªæ–°å·¥å…·å’ŒåŠŸèƒ½ã€‚æˆ‘ä»¬çš„ VS Code æ’ä»¶éœ€è¦è·Ÿè¿›è¿™äº›å˜åŒ–ï¼Œä»¥ï¼š

1. **ä¿æŒå…¼å®¹æ€§**ï¼šæ”¯æŒ Claude CLI çš„æ‰€æœ‰æ–°å·¥å…·
2. **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šåˆ©ç”¨æ–°å·¥å…·æä¾›æ›´å¥½çš„äº¤äº’
3. **ç‰ˆæœ¬å·ç‹¬ç«‹**ï¼šå°†æ’ä»¶ç‰ˆæœ¬ä¸ CLI ç‰ˆæœ¬è§£è€¦ï¼Œä½¿ç”¨ç‹¬ç«‹çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬

### 1.2 æ ¸å¿ƒæ¶æ„è¯´æ˜ï¼ˆé‡è¦ï¼ï¼‰

âš ï¸ **è¿™ä¸æ˜¯ SDK æ¨¡å¼ï¼Œè€Œæ˜¯ CLI åŒ…è£…å™¨æ¨¡å¼ï¼**

```
ç”¨æˆ·è¾“å…¥ â†’ Webview â†’ ClaudeChatProvider
                           â†“
                    ClaudeProcessService
                           â†“
                    spawn('claude', [...args])  â† ç›´æ¥è°ƒç”¨ CLIï¼
                           â†“
                      stdio (stdin/stdout)
                           â†“
                    MessageProcessor è§£æ JSON æµ
                           â†“
                      å‘é€å› Webview
```

**å…³é”®ç‚¹**ï¼š
- æ’ä»¶é€šè¿‡ `child_process.spawn()` å¯åŠ¨ Claude CLI è¿›ç¨‹
- ç”¨æˆ·æ¶ˆæ¯é€šè¿‡ `stdin` å‘é€ç»™ CLI
- CLI å“åº”é€šè¿‡ `stdout` ä»¥ JSON æµå½¢å¼è¿”å›
- `MessageProcessor` è§£æè¿™äº› JSON è¡Œï¼Œæå– `tool_use`ã€`text`ã€`result` ç­‰äº‹ä»¶
- **å·¥å…·ç”± CLI æ‰§è¡Œï¼Œæ’ä»¶åªè´Ÿè´£è§£æå’Œå±•ç¤ºï¼**

**è¿™æ„å‘³ç€**ï¼š
- æ–°å·¥å…·ï¼ˆå¦‚ `TaskOutput`, `KillShell`ï¼‰æ˜¯ CLI è‡ªå·±è°ƒç”¨çš„
- æ’ä»¶åªéœ€è¦è§£æ `tool_use` äº‹ä»¶å¹¶å±•ç¤º
- æŸäº›å·¥å…·ï¼ˆå¦‚ `AskUserQuestion`ï¼‰éœ€è¦æ’ä»¶æä¾› UI äº¤äº’ï¼Œç„¶åæŠŠç»“æœå‘å› CLI

---

## 2. Claude Code CLI 2.1.2 æ–°å·¥å…·ä½“ç³»

### 2.1 å†…ç½®å·¥å…·æ¸…å•ï¼ˆ17ä¸ªï¼‰

```
æ ¸å¿ƒå·¥å…·:
â”œâ”€â”€ Task          - å¯åŠ¨å­ä»£ç†å¤„ç†å¤æ‚ä»»åŠ¡
â”œâ”€â”€ TaskOutput    - ğŸ†• è·å–æ­£åœ¨è¿è¡Œ/å·²å®Œæˆä»»åŠ¡çš„è¾“å‡º
â”œâ”€â”€ Bash          - æ‰§è¡Œ bash å‘½ä»¤
â”œâ”€â”€ KillShell     - ğŸ†• ç»ˆæ­¢åå°è¿è¡Œçš„ shell
â”œâ”€â”€ Glob          - æ–‡ä»¶æ¨¡å¼åŒ¹é…
â”œâ”€â”€ Grep          - åŸºäº ripgrep çš„æœç´¢
â”œâ”€â”€ Read          - è¯»å–æ–‡ä»¶
â”œâ”€â”€ Edit          - ç¼–è¾‘æ–‡ä»¶
â”œâ”€â”€ Write         - å†™å…¥æ–‡ä»¶
â”œâ”€â”€ NotebookEdit  - ç¼–è¾‘ Jupyter notebook
â”œâ”€â”€ WebFetch      - è·å–ç½‘é¡µå†…å®¹
â”œâ”€â”€ WebSearch     - ç½‘ç»œæœç´¢
â”œâ”€â”€ TodoWrite     - ä»»åŠ¡åˆ—è¡¨ç®¡ç†
â”œâ”€â”€ AskUserQuestion - ğŸ†• å‘ç”¨æˆ·æé—®
â”œâ”€â”€ Skill         - ğŸ†• æ‰§è¡ŒæŠ€èƒ½/æ–œæ å‘½ä»¤
â”œâ”€â”€ EnterPlanMode - ğŸ†• è¿›å…¥è®¡åˆ’æ¨¡å¼
â””â”€â”€ ExitPlanMode  - ğŸ†• é€€å‡ºè®¡åˆ’æ¨¡å¼
```

### 2.2 æ–°å¢å·¥å…·è¯¦ç»†è¯´æ˜ï¼ˆåŸºäº CLI åŒ…è£…å™¨æ¨¡å¼ï¼‰

> âš ï¸ **é‡è¦**ï¼šè¿™äº›å·¥å…·éƒ½æ˜¯ Claude CLI è‡ªå·±è°ƒç”¨çš„ï¼Œæ’ä»¶åªéœ€è¦è§£æå’Œå±•ç¤ºã€‚
> åªæœ‰ `AskUserQuestion` éœ€è¦æ’ä»¶æä¾›äº¤äº’ UIã€‚

#### 2.2.1 TaskOutput
- **ç”¨é€”**ï¼šè·å–åå°è¿è¡Œä»»åŠ¡çš„è¾“å‡º
- **åœºæ™¯**ï¼šClaude åœ¨ç­‰å¾… subagent å®Œæˆæ—¶æŸ¥è¯¢è¿›åº¦
- **å‚æ•°**ï¼š`task_id`, `block`, `timeout`
- **æ’ä»¶éœ€è¦åšçš„**ï¼š
  - è§£æ `tool_use` äº‹ä»¶ï¼Œè¯†åˆ« `TaskOutput` å·¥å…·
  - åœ¨ UI ä¸­æ˜¾ç¤º subagent çŠ¶æ€ï¼ˆå¯é€‰ï¼šæŠ˜å é¢æ¿ï¼‰
  - **ä¸éœ€è¦**å®ç°å·¥å…·é€»è¾‘ï¼ŒCLI ä¼šè‡ªå·±å¤„ç†

#### 2.2.2 KillShell
- **ç”¨é€”**ï¼šç»ˆæ­¢åå°è¿è¡Œçš„ shell è¿›ç¨‹
- **åœºæ™¯**ï¼šClaude éœ€è¦åœæ­¢ä¸€ä¸ªè¶…æ—¶æˆ–ä¸éœ€è¦çš„åå°ä»»åŠ¡
- **å‚æ•°**ï¼š`shell_id`
- **æ’ä»¶éœ€è¦åšçš„**ï¼š
  - è§£æ `tool_use` äº‹ä»¶
  - åœ¨ UI ä¸­æ˜¾ç¤º"ç»ˆæ­¢è¿›ç¨‹"çŠ¶æ€
  - **ä¸éœ€è¦**å®ç°æ€è¿›ç¨‹é€»è¾‘

#### 2.2.3 AskUserQuestion ğŸ”´ é‡ç‚¹
- **ç”¨é€”**ï¼šClaude éœ€è¦å‘ç”¨æˆ·æé—®å¹¶è·å–é€‰æ‹©
- **åœºæ™¯**ï¼šéœ€è¦ç”¨æˆ·ç¡®è®¤æˆ–é€‰æ‹©æ—¶ï¼ˆå¦‚é€‰æ‹©è®¤è¯æ–¹å¼ï¼‰
- **å‚æ•°**ï¼š
  ```typescript
  {
    questions: [{
      question: string,      // é—®é¢˜å†…å®¹
      header: string,        // æ ‡ç­¾ï¼ˆæœ€å¤š12å­—ç¬¦ï¼‰
      options: [{
        label: string,       // é€‰é¡¹æ˜¾ç¤ºæ–‡æœ¬
        description: string  // é€‰é¡¹æè¿°
      }],
      multiSelect: boolean   // æ˜¯å¦å¤šé€‰
    }]
  }
  ```
- **æ’ä»¶éœ€è¦åšçš„**ï¼š
  1. è§£æ `tool_use` äº‹ä»¶ï¼Œè¯†åˆ« `AskUserQuestion`
  2. **åœ¨ UI ä¸­æ¸²æŸ“é€‰é¡¹è¡¨å•**ï¼ˆå•é€‰/å¤šé€‰ï¼‰
  3. ç”¨æˆ·é€‰æ‹©åï¼Œ**å°†ç»“æœä½œä¸º tool_result å‘å› CLI stdin**
  4. è¿™æ˜¯**å”¯ä¸€éœ€è¦åŒå‘äº¤äº’**çš„å·¥å…·

#### 2.2.4 Skill
- **ç”¨é€”**ï¼šæ‰§è¡Œé¢„å®šä¹‰çš„æŠ€èƒ½ï¼ˆæ–œæ å‘½ä»¤ï¼‰
- **åœºæ™¯**ï¼šClaude å†³å®šè°ƒç”¨æŸä¸ªæŠ€èƒ½
- **å‚æ•°**ï¼š`skill`, `args`
- **æ’ä»¶éœ€è¦åšçš„**ï¼š
  - è§£æ `tool_use` äº‹ä»¶
  - åœ¨ UI ä¸­æ˜¾ç¤º"æ‰§è¡ŒæŠ€èƒ½: xxx"
  - **å¯é€‰**ï¼šæä¾›æ–œæ å‘½ä»¤è‡ªåŠ¨è¡¥å…¨ï¼ˆè¾“å…¥æ¡†åŠŸèƒ½ï¼‰
  - **ä¸éœ€è¦**å®ç°æŠ€èƒ½é€»è¾‘ï¼ŒCLI ä¼šå¤„ç†

#### 2.2.5 EnterPlanMode / ExitPlanMode
- **ç”¨é€”**ï¼šClaude è‡ªä¸»åˆ‡æ¢è®¡åˆ’æ¨¡å¼
- **åœºæ™¯**ï¼šClaude è®¤ä¸ºéœ€è¦å…ˆè§„åˆ’å†æ‰§è¡Œ
- **æ—§å®ç°**ï¼šç”¨æˆ·ç‚¹å‡»å¼€å…³ â†’ æ¶ˆæ¯å‰ç¼€ `PLAN FIRST...`
- **æ–°å®ç°**ï¼šClaude è‡ªå·±è°ƒç”¨å·¥å…·
- **æ’ä»¶éœ€è¦åšçš„**ï¼š
  - è§£æ `tool_use` äº‹ä»¶
  - å½“æ£€æµ‹åˆ° `EnterPlanMode` æ—¶ï¼Œæ›´æ–° UI çŠ¶æ€ï¼ˆå¦‚è¾¹æ¡†å˜è“ï¼‰
  - å½“æ£€æµ‹åˆ° `ExitPlanMode` æ—¶ï¼Œæ¢å¤ UI çŠ¶æ€
  - **å¯é€‰**ï¼šä¿ç•™ç”¨æˆ·æ‰‹åŠ¨è§¦å‘ï¼ˆä½œä¸ºæç¤º hintï¼‰

---

## 3. åŠŸèƒ½å˜æ›´æ¸…å•

### 3.1 ç§»é™¤åŠŸèƒ½

#### 3.1.1 æ“ä½œæŒ‰é’®ï¼ˆOperation History Buttonï¼‰
- **ä½ç½®**ï¼šå³ä¸Šè§’ç¬¬ä¸‰ä¸ªæŒ‰é’® ğŸ”„
- **å½“å‰åŠŸèƒ½**ï¼šæ‰“å¼€æ“ä½œå†å²é¢æ¿ï¼Œæ”¯æŒæ’¤é”€/é‡åš
- **ç§»é™¤åŸå› **ï¼š
  1. ä½¿ç”¨é¢‘ç‡ä½
  2. å ç”¨å®è´µçš„ header ç©ºé—´
  3. åŠŸèƒ½å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼è®¿é—®
- **æ›¿ä»£æ–¹æ¡ˆ**ï¼š
  - å¿«æ·é”® `Ctrl+Z` / `Ctrl+Shift+Z`
  - å‘½ä»¤é¢æ¿ `Claude Code: Undo Last Operation`
  - è®¾ç½®é¢æ¿ä¸­æ·»åŠ æ“ä½œå†å²å…¥å£

### 3.2 æ–°å¢åŠŸèƒ½

#### 3.2.1 AskUserQuestion UI ç»„ä»¶ âœ… è®¾è®¡å®Œæˆ

**è®¾è®¡æ–¹æ¡ˆ**ï¼šå¼¹å‡ºå¯¹è¯æ¡†ï¼ˆModalï¼‰

**è®¾è®¡æ–‡ä»¶**ï¼š`reference/AskUserQuestion_Modal_Design_v3.html`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘ï¸ ASK USER QUESTION                             â”‚
â”‚    Phase Planning                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â“ How should we proceed with restructuring...   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–Œ Re-evaluate Priorities              â† é€‰ä¸­çŠ¶æ€ â”‚
â”‚ â”‚ Re-sort phases based on dependencies...        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚   Merge or Split Phases                          â”‚
â”‚   Break down large phases or combine...          â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚   Add/Remove Features                            â”‚
â”‚   Include missing features or remove...          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚ Other (please specify)...           â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 12s â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘                            [Skip] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è®¾è®¡ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨ Claude çœ¼ç›å›¾æ ‡ï¼ˆVS Code é£æ ¼ SVGï¼‰
- å…¨è‹±æ–‡ç•Œé¢
- VS Code åŸç”Ÿåˆ—è¡¨é€‰ä¸­æ ·å¼ï¼ˆèƒŒæ™¯é«˜äº® + å·¦ä¾§å¼ºè°ƒæ¡ï¼‰
- é—®é¢˜å‰æ˜¾ç¤º â“ å›¾æ ‡

**äº¤äº’é€»è¾‘**ï¼š
| æ¨¡å¼ | è¡Œä¸º |
|------|------|
| å•é€‰æ¨¡å¼ | ç‚¹å‡»é€‰é¡¹ç«‹å³æäº¤ï¼Œæ—  Confirm æŒ‰é’® |
| å¤šé€‰æ¨¡å¼ | å‹¾é€‰å¤šä¸ªé€‰é¡¹ï¼Œç‚¹å‡» Confirm æäº¤ |
| è‡ªå®šä¹‰è¾“å…¥ | æŒ‰ Enter æäº¤ |
| Skip æŒ‰é’® | å‘é€ç©ºå­—ç¬¦ä¸² `""` |
| 15ç§’è¶…æ—¶ | å‘é€ `"Please decide on your own"` |

**æŠ€æœ¯å®ç°**ï¼š
- å¤ç”¨ç°æœ‰ Modal æ ·å¼ç³»ç»Ÿï¼ˆ`styles/components/modals.ts`ï¼‰
- åœ¨ `MessageProcessor` ä¸­è¯†åˆ« `AskUserQuestion` å·¥å…·
- é€šè¿‡ `postMessage` å°†ç”¨æˆ·é€‰æ‹©å‘å› extension host
- extension host å°†å“åº”å†™å…¥ CLI stdin

#### 3.2.2 Skill è‡ªåŠ¨è¡¥å…¨èœå•
**è®¾è®¡æ–¹æ¡ˆ**ï¼šè¾“å…¥ `/` æ—¶è§¦å‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å…¥æ¡†: /com                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¯ Matching Skills                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ /commit                         â”‚ â”‚
â”‚ â”‚   Create a git commit           â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ /compact                        â”‚ â”‚
â”‚ â”‚   Compact conversation context  â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ /component-scaffold             â”‚ â”‚
â”‚ â”‚   Scaffold a new component      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°è¦ç‚¹**ï¼š
- å®æ—¶è¿‡æ»¤åŒ¹é…
- æ˜¾ç¤ºæŠ€èƒ½æè¿°
- æŒ‰åˆ†ç±»ç»„ç»‡
- é”®ç›˜å¯¼èˆªæ”¯æŒï¼ˆâ†‘â†“ Enterï¼‰
- Tab è¡¥å…¨

#### 3.2.3 Plan Mode å·¥å…·é©±åŠ¨é€‚é… âœ… è®¾è®¡å®Œæˆ

**è®¾è®¡æ–¹æ¡ˆ**ï¼šå“åº”å¼çŠ¶æ€åŒæ­¥

**æ—§é€»è¾‘**ï¼š
```
ç”¨æˆ·ç‚¹å‡» Plan First å¼€å…³ â†’ æ¶ˆæ¯å‰ç¼€æ·»åŠ  â†’ å‘é€ç»™ Claude
```

**æ–°é€»è¾‘**ï¼š
```
ç”¨æˆ·å‘é€æ¶ˆæ¯ â†’ Claude å†³å®šæ˜¯å¦è°ƒç”¨ EnterPlanMode
â†’ UI æ”¶åˆ° tool_use äº‹ä»¶ â†’ è‡ªåŠ¨åˆ‡æ¢ Plan Mode çŠ¶æ€æ˜¾ç¤º
â†’ Claude è°ƒç”¨ ExitPlanMode â†’ UI æ˜¾ç¤ºç¡®è®¤å¼¹çª— â†’ ç”¨æˆ·ç¡®è®¤åæ¢å¤æ­£å¸¸çŠ¶æ€
```

**å·¥å…·è°ƒç”¨ JSON ç»“æ„**ï¼ˆä» debug_log.txt æ•è·ï¼‰ï¼š
```json
// EnterPlanMode - è‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€ç”¨æˆ·ç¡®è®¤
{"type": "tool_use", "id": "toolu_xxx", "name": "EnterPlanMode", "input": {}}

// ExitPlanMode - è¿”å› is_error: trueï¼Œéœ€è¦ç”¨æˆ·ç¡®è®¤
{"type": "tool_result", "content": "Exit plan mode?", "is_error": true, "tool_use_id": "..."}
```

**Plan Mode çŠ¶æ€é¢œè‰²**ï¼š
| çŠ¶æ€ | é¢œè‰² | CSS å˜é‡ |
|------|------|----------|
| æ­£å¸¸æ¨¡å¼ | é’è‰²ï¼ˆPrimaryï¼‰ | `--grad-primary-start: #7DFBFF` |
| **Plan Mode** | **ç´«è‰²ï¼ˆThinkingï¼‰** | `--grad-thinking: #B794F4` |

**é€‰æ‹©ç´«è‰²çš„ç†ç”±**ï¼š
1. **è¯­ä¹‰å¥‘åˆ**ï¼šPlan Mode æ˜¯"è§„åˆ’/æ€è€ƒæ¨¡å¼"ï¼Œä¸ thinking æ¸å˜è¯­ä¹‰ä¸€è‡´
2. **è§†è§‰åŒºåˆ†**ï¼šç´«è‰²ä¸ä¸»è‰²ï¼ˆé’è‰²ï¼‰æœ‰æ˜æ˜¾åŒºåˆ†
3. **å¤ç”¨ç°æœ‰**ï¼šæ— éœ€æ–°å¢ CSS å˜é‡ï¼Œä¿æŒç³»ç»Ÿç®€æ´
4. **é…è‰²åè°ƒ**ï¼šç´«è‰²ä¸ SwiftGlowï¼ˆé’â†’ç´«ï¼‰é…è‰²ä½“ç³»å’Œè°

**UI å˜åŒ–**ï¼š
- Plan First å¼€å…³å˜ä¸º**åªè¯»çŠ¶æ€æŒ‡ç¤ºå™¨**
- å½“ Claude è¿›å…¥ Plan Mode æ—¶ï¼š
  - è¾“å…¥åŒºåŸŸå·¦è¾¹æ¡†é¢œè‰²å˜ä¸ºç´«è‰² `#B794F4`
  - æ˜¾ç¤º "ğŸ“‹ Planning..." çŠ¶æ€
- å½“ Claude è°ƒç”¨ ExitPlanMode æ—¶ï¼š
  - æ˜¾ç¤ºç¡®è®¤å¼¹çª—ï¼ˆä¸ AskUserQuestion ç›¸åŒè®¾è®¡ï¼‰
  - 10 ç§’è¶…æ—¶è‡ªåŠ¨ç¡®è®¤
- ä¿ç•™æ‰‹åŠ¨è§¦å‘é€‰é¡¹ï¼ˆå‘é€æ—¶æºå¸¦ hintï¼‰

**ExitPlanMode ç¡®è®¤å¼¹çª—**ï¼š

è®¾è®¡ä¸ AskUserQuestion ä¿æŒä¸€è‡´ï¼Œä½¿ç”¨ç›¸åŒçš„ Modal ç»„ä»¶ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘ï¸ EXIT PLAN MODE                                â”‚
â”‚    Plan Confirmation                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â“ Exit plan mode?                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–Œ Yes, exit plan mode                  â† é€‰ä¸­çŠ¶æ€â”‚
â”‚ â”‚ Confirm and proceed with implementation        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚   No, continue planning                          â”‚
â”‚   Stay in plan mode for further refinement       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 10s â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘                          [Skip] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº¤äº’é€»è¾‘**ï¼š
| æ“ä½œ | è¡Œä¸º |
|------|------|
| ç‚¹å‡» "Yes" | ç¡®è®¤é€€å‡ºï¼Œæ¢å¤æ­£å¸¸æ¨¡å¼ï¼Œ**åŒæ­¥å…³é—­ Plan First å¼€å…³** |
| ç‚¹å‡» "No" | å–æ¶ˆé€€å‡ºï¼Œä¿æŒ Plan Mode |
| Skip æŒ‰é’® | å‘é€ç©ºå­—ç¬¦ä¸²ï¼Œç”± Claude å†³å®š |
| 10ç§’è¶…æ—¶ | è‡ªåŠ¨ç¡®è®¤é€€å‡ºï¼Œ**åŒæ­¥å…³é—­ Plan First å¼€å…³** |

**çŠ¶æ€åŒæ­¥è§„åˆ™**ï¼š
| äº‹ä»¶ | Plan First å¼€å…³çŠ¶æ€ | è¾“å…¥æ¡†å·¦è¾¹æ¡†é¢œè‰² |
|------|---------------------|------------------|
| æ£€æµ‹åˆ° `EnterPlanMode` tool_use | è‡ªåŠ¨å¼€å¯ï¼ˆONï¼‰ | ç´«è‰² `#B794F4` |
| ç”¨æˆ·ç¡®è®¤ ExitPlanModeï¼ˆYes/è¶…æ—¶ï¼‰ | è‡ªåŠ¨å…³é—­ï¼ˆOFFï¼‰ | æ¢å¤é’è‰² `#7DFBFF` |
| ç”¨æˆ·æ‹’ç» ExitPlanModeï¼ˆNoï¼‰ | ä¿æŒå¼€å¯ï¼ˆONï¼‰ | ä¿æŒç´«è‰² |
| ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡» Plan First å¼€å…³ | åˆ‡æ¢çŠ¶æ€ | è·Ÿéšå¼€å…³çŠ¶æ€å˜åŒ– |

**Plan First æç¤ºè¯ä¿®æ”¹**ï¼š

ç”¨æˆ·æ‰‹åŠ¨å¼€å¯ Plan First å¼€å…³æ—¶ï¼Œéœ€è¦åœ¨æ¶ˆæ¯å‰æ·»åŠ æç¤ºè¯ï¼Œå¼•å¯¼ Claude ä½¿ç”¨ `EnterPlanMode` å·¥å…·ã€‚

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ—§æç¤ºè¯** | `PLAN FIRST FOR THIS MESSAGE ONLY: Plan first before making any changes. Show me in detail what you will change and wait for my explicit approval in a separate message before proceeding. Do not implement anything until I confirm. This planning requirement applies ONLY to this current message.` |
| **æ–°æç¤ºè¯** | `ENTER PLAN MODE: Use the EnterPlanMode tool to enter planning mode. Create a detailed implementation plan and wait for my explicit approval before making any changes. Do not implement anything until I confirm by selecting 'Yes' in the ExitPlanMode dialog. This planning requirement applies ONLY to this current message.` |

**ä¿®æ”¹ç‚¹**ï¼š
1. æ ‡é¢˜æ”¹ä¸º `ENTER PLAN MODE`ï¼ˆæ›´ç›´æ¥æ˜ç¡®ï¼‰
2. æ˜ç¡®æŒ‡ç¤ºä½¿ç”¨ `EnterPlanMode` å·¥å…·
3. æåˆ° `ExitPlanMode` å¯¹è¯æ¡†çš„ç¡®è®¤æµç¨‹
4. ä¿ç•™"ä»…é€‚ç”¨äºå½“å‰æ¶ˆæ¯"çš„è¯´æ˜

**ä»£ç ä½ç½®**ï¼š`src/providers/ClaudeChatProvider.ts:466`

#### 3.2.4 KillShell è‡ªåŠ¨æ¸…ç†
**è®¾è®¡æ–¹æ¡ˆ**ï¼šè‡ªåŠ¨ + æ‰‹åŠ¨

- **è‡ªåŠ¨æ¸…ç†**ï¼š
  - ç‚¹å‡» "Stop" æŒ‰é’®æ—¶ç»ˆæ­¢æ‰€æœ‰åå° shell
  - æ’ä»¶åœç”¨æ—¶æ¸…ç†æ‰€æœ‰è¿›ç¨‹
  - ä¼šè¯ç»“æŸæ—¶æ¸…ç†

- **æ‰‹åŠ¨æ¸…ç†**ï¼š
  - åœ¨ subagent è¾“å‡ºåŒºåŸŸæ·»åŠ  "ç»ˆæ­¢" æŒ‰é’®
  - å‘½ä»¤é¢æ¿ `Claude Code: Kill Background Tasks`

#### 3.2.5 TaskOutput æŠ˜å æ˜¾ç¤º
**è®¾è®¡æ–¹æ¡ˆ**ï¼šå¯æŠ˜å çš„ subagent æ—¥å¿—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¶ Subagent: Explore (task-abc123)        [Running] â”‚
â”‚   Searching for files matching "*.ts"...           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¼ Subagent: Code Review (task-def456)   [Complete] â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Reviewed 5 files                           â”‚   â”‚
â”‚   â”‚ Found 2 issues:                            â”‚   â”‚
â”‚   â”‚ - src/index.ts:42 - Missing error handling â”‚   â”‚
â”‚   â”‚ - src/utils.ts:15 - Unused import          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Skill ç®¡ç†ç³»ç»Ÿ

### 4.1 Skills æ¦‚è§ˆ
ä» Claude CLI 2.1.2 ä¸­è·å–çš„æŠ€èƒ½åˆ†ä¸ºä»¥ä¸‹ç±»åˆ«ï¼š

| ç±»åˆ« | æŠ€èƒ½æ•°é‡ | ç¤ºä¾‹ |
|------|----------|------|
| backend-development | 3 | api-design-principles, architecture-patterns |
| cloud-infrastructure | 4 | cost-optimization, terraform-module-library |
| python-development | 5 | async-python-patterns, uv-package-manager |
| javascript-typescript | 4 | modern-javascript-patterns, typescript-advanced-types |
| **é€šç”¨** | 8 | compact, context, cost, init, pr-comments, etc. |

### 4.2 Skill ç®¡ç†ç•Œé¢è®¾è®¡

**å…¥å£**ï¼šè¾“å…¥æ¡†å·¦ä¾§çš„ "Skills" æŒ‰é’®ï¼ˆç±»ä¼¼ç°æœ‰çš„ Tools æŒ‰é’®ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Skills                                         [âœ•]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Search skills...                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â­ Favorites                                         â”‚
â”‚   /commit          Create a git commit              â”‚
â”‚   /review          Review code changes              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ backend-development                              â”‚
â”‚   /api-design-principles    REST/GraphQL design     â”‚
â”‚   /architecture-patterns    Clean/Hexagonal arch    â”‚
â”‚   /microservices-patterns   Service boundaries      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ cloud-infrastructure                             â”‚
â”‚   /cost-optimization        Cloud cost reduction    â”‚
â”‚   /terraform-module-library Reusable IaC modules    â”‚
â”‚   ...                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ python-development                               â”‚
â”‚   /async-python-patterns    asyncio/await patterns  â”‚
â”‚   /python-packaging         PyPI distribution       â”‚
â”‚   ...                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Skill ä½¿ç”¨æ–¹å¼

1. **æ–œæ å‘½ä»¤**ï¼šåœ¨è¾“å…¥æ¡†è¾“å…¥ `/skill-name`
2. **è‡ªåŠ¨è¡¥å…¨**ï¼šè¾“å…¥ `/` åæ˜¾ç¤ºå€™é€‰åˆ—è¡¨
3. **ç®¡ç†é¢æ¿**ï¼šç‚¹å‡»ç›´æ¥æ’å…¥åˆ°è¾“å…¥æ¡†
4. **æ”¶è—åŠŸèƒ½**ï¼šå¸¸ç”¨æŠ€èƒ½å¿«é€Ÿè®¿é—®

---

## 5. UI å¸ƒå±€è°ƒæ•´

### 5.1 Header åŒºåŸŸ

**å½“å‰ï¼ˆ2.1.3ï¼‰**ï¼š
```
[Claude Code Chat v2.1.3]                    [âš™ï¸] [ğŸ“ˆ] [ğŸ”„] [ğŸ“œ] [New Chat]
                                             è®¾ç½®  ç»Ÿè®¡  æ“ä½œ  å†å²
```

**æ–°ç‰ˆï¼ˆ3.0.xï¼‰**ï¼š
```
[Claude Code Chat v3.0.x]                    [âš™ï¸] [ğŸ“ˆ] [ğŸ“œ] [New Chat]
                                             è®¾ç½®  ç»Ÿè®¡  å†å²
```

### 5.2 è¾“å…¥åŒºåŸŸ

**å½“å‰**ï¼š
```
[Plan First] [Thinking Mode] [Language Mode]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type your message...                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Model â–¼] [Mode â–¼] [Tools â–¼] [Plugins â–¼]     [Send] [â¬œ]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ–°ç‰ˆ**ï¼š
```
[Plan First ğŸ“‹] [Thinking Mode] [Language Mode]  â† Plan First å˜ä¸ºçŠ¶æ€æŒ‡ç¤ºå™¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type your message... (Type / for skills)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Model â–¼] [Mode â–¼] [Tools â–¼] [Skills â–¼] [Plugins â–¼] [Send] [â¬œ]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†‘ æ–°å¢ Skills æŒ‰é’®
```

### 5.3 èŠå¤©åŒºåŸŸæ–°å¢ç»„ä»¶

1. **AskUserQuestion è¡¨å•**ï¼šå†…è”åœ¨æ¶ˆæ¯æµä¸­
2. **TaskOutput æŠ˜å é¢æ¿**ï¼šsubagent è¾“å‡º
3. **Plan Mode çŠ¶æ€æŒ‡ç¤ºå™¨**ï¼šè¾¹æ¡†é¢œè‰²å˜åŒ–

---

## 6. æŠ€æœ¯å®ç°è®¡åˆ’

### 6.1 éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | ä¼˜å…ˆçº§ |
|------|----------|--------|
| `package.json` | ç‰ˆæœ¬å·æ›´æ–° | P0 |
| `getBodyContent.ts` | ç§»é™¤æ“ä½œæŒ‰é’®ï¼Œæ·»åŠ  Skills æŒ‰é’® | P0 |
| `ui-script.ts` | AskUserQuestion UIï¼ŒSkill è¡¥å…¨ï¼ŒPlan Mode çŠ¶æ€ | P0 |
| `MessageProcessor.ts` | å¤„ç†æ–°å·¥å…·ç±»å‹ | P0 |
| `ClaudeChatProvider.ts` | æ–°å·¥å…·åç«¯é€»è¾‘ | P0 |
| `styles/features/*.ts` | æ–°ç»„ä»¶æ ·å¼ | P1 |
| `types/index.ts` | æ–°ç±»å‹å®šä¹‰ | P1 |

### 6.2 æ–°å¢æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `ui-v2/components/AskUserQuestion.ts` | AskUserQuestion UI ç»„ä»¶ |
| `ui-v2/components/SkillSelector.ts` | Skill é€‰æ‹©å™¨ç»„ä»¶ |
| `ui-v2/components/TaskOutputPanel.ts` | TaskOutput æŠ˜å é¢æ¿ |
| `managers/SkillManager.ts` | Skill ç®¡ç†é€»è¾‘ |

### 6.3 å®ç°ä¼˜å…ˆçº§

```
Phase 1: åŸºç¡€å‡çº§
â”œâ”€â”€ ç‰ˆæœ¬å·æ›´æ–°
â”œâ”€â”€ ç§»é™¤æ“ä½œæŒ‰é’®
â””â”€â”€ æ›´æ–° MessageProcessor æ”¯æŒæ–°å·¥å…·

Phase 2: AskUserQuestion
â”œâ”€â”€ UI ç»„ä»¶è®¾è®¡
â”œâ”€â”€ æ¶ˆæ¯å¤„ç†
â””â”€â”€ å“åº”æäº¤

Phase 3: Skill ç³»ç»Ÿ
â”œâ”€â”€ æ–œæ å‘½ä»¤è‡ªåŠ¨è¡¥å…¨
â”œâ”€â”€ Skill ç®¡ç†é¢æ¿
â””â”€â”€ æ”¶è—åŠŸèƒ½

Phase 4: Plan Mode é€‚é…
â”œâ”€â”€ çŠ¶æ€æŒ‡ç¤ºå™¨
â”œâ”€â”€ å·¥å…·é©±åŠ¨é€»è¾‘
â””â”€â”€ è¾¹æ¡†é¢œè‰²å˜åŒ–

Phase 5: KillShell + TaskOutput
â”œâ”€â”€ è‡ªåŠ¨æ¸…ç†é€»è¾‘
â”œâ”€â”€ æŠ˜å é¢æ¿ UI
â””â”€â”€ ç»ˆæ­¢æŒ‰é’®
```

---

## 7. æµ‹è¯•è®¡åˆ’

### 7.1 åŠŸèƒ½æµ‹è¯•

| æµ‹è¯•é¡¹ | éªŒè¯å†…å®¹ |
|--------|----------|
| AskUserQuestion | å•é€‰ã€å¤šé€‰ã€è‡ªå®šä¹‰è¾“å…¥ã€æäº¤ |
| Skill | è‡ªåŠ¨è¡¥å…¨ã€ç®¡ç†é¢æ¿ã€æ‰§è¡Œ |
| Plan Mode | çŠ¶æ€åŒæ­¥ã€è¾¹æ¡†å˜åŒ– |
| KillShell | ç»ˆæ­¢åå°ä»»åŠ¡ã€èµ„æºæ¸…ç† |
| TaskOutput | æŠ˜å /å±•å¼€ã€æµå¼æ›´æ–° |

### 7.2 å…¼å®¹æ€§æµ‹è¯•

- [ ] Claude CLI 2.1.2+
- [ ] VS Code 1.85+
- [ ] Windows 10/11
- [ ] macOS (å¯é€‰)

### 7.3 æ€§èƒ½æµ‹è¯•

- [ ] å¤§é‡ TaskOutput ä¸å½±å“ UI å“åº”
- [ ] Skill åˆ—è¡¨åŠ è½½é€Ÿåº¦
- [ ] å†…å­˜å ç”¨ç›‘æ§

---

## 8. é£é™©å’Œç¼“è§£æªæ–½

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| CLI ç‰ˆæœ¬ä¸å…¼å®¹ | é«˜ | ç‰ˆæœ¬æ£€æµ‹ï¼Œé™çº§å¤„ç† |
| UI ç»„ä»¶æ€§èƒ½é—®é¢˜ | ä¸­ | è™šæ‹Ÿåˆ—è¡¨ï¼Œæ‡’åŠ è½½ |
| ç”¨æˆ·ä¹ æƒ¯æ”¹å˜ | ä¸­ | æ¸è¿›å¼æ›´æ–°ï¼Œä¿ç•™å¿«æ·é”® |

---

## é™„å½•

### A. è°ƒè¯•æ–¹æ¡ˆ

âœ… **å·²å®Œæˆ**ï¼š
- DebugLogger ç³»ç»Ÿå·²å®ç°
- æ”¯æŒé€šè¿‡è®¾ç½® `claudeCodeChatUI.debug.enabled: true` å¯ç”¨
- è‡ªåŠ¨å†™å…¥ `{workspacePath}/debug_log.txt`
- æ»šåŠ¨å¤‡ä»½åŠŸèƒ½ï¼ˆå¯åŠ¨æ—¶æ—§æ—¥å¿— â†’ `debug_log.bak`ï¼‰

### B. Tools åˆ—è¡¨æ›´æ–°

**éœ€è¦æ·»åŠ çš„å·¥å…·**ï¼š

| å·¥å…·å | æè¿° | å›¾æ ‡ |
|--------|------|------|
| TaskOutput | Get output from running/completed tasks | ğŸ“¤ |
| KillShell | Kill background shell | ğŸ”ª |
| AskUserQuestion | Ask user for input | â“ |
| Skill | Execute skills/slash commands | âš¡ |
| EnterPlanMode | Enter planning mode | ğŸ“‹ |

**éœ€è¦ç§»é™¤çš„å·¥å…·**ï¼š

| å·¥å…·å | åŸå›  |
|--------|------|
| LS | å·²è¢« Glob æ›¿ä»£ |

### C. é—æ¼çš„è€ƒè™‘ç‚¹

1. **CLI ç‰ˆæœ¬å…¼å®¹æ€§**ï¼šæ’ä»¶å¯åŠ¨æ—¶åº”æ£€æŸ¥ `claude --version`
2. **Thinking Block å±•ç¤º**ï¼šClaude 3.7+ æ”¯æŒ extended thinkingï¼Œéœ€è¦æ·»åŠ æŠ˜å å—
3. **AskUserQuestion è¶…æ—¶å¤„ç†**ï¼šå¦‚æœç”¨æˆ·é•¿æ—¶é—´ä¸å“åº”ï¼ŒCLI å¯èƒ½ä¼šè¶…æ—¶
4. **KillShell å®‰å…¨æ€§**ï¼šå¿…é¡»æ ¡éªŒ PID å½’å±ï¼Œç¡®ä¿åªç»ˆæ­¢ Claude CLI çš„å­è¿›ç¨‹

### D. é¢œè‰²ç³»ç»Ÿå‚è€ƒè¡¨

**ä¸»æ¸å˜è‰² (Primary Gradient - SwiftGlow)**
| å˜é‡å | é¢œè‰²å€¼ | ç”¨é€” |
|--------|--------|------|
| `--grad-primary` | `#7DFBFF â†’ #A185FF` | ä¸»æ¸å˜ï¼ˆé’â†’ç´«ï¼‰ |
| `--grad-primary-start` | `#7DFBFF` | ä¸»è‰²èµ·ç‚¹ï¼ˆé’è‰²ï¼‰ |
| `--grad-primary-end` | `#A185FF` | ä¸»è‰²ç»ˆç‚¹ï¼ˆç´«è‰²ï¼‰ |
| `--grad-primary-mid` | `#8BE9FF` | ä¸»è‰²ä¸­é—´å€¼ |

**è¯­ä¹‰æ¸å˜è‰² (Semantic Gradients)**
| å˜é‡å | é¢œè‰²å€¼ | ç”¨é€” |
|--------|--------|------|
| `--grad-success` | `#23CE6B â†’ #00D9A3` | æˆåŠŸçŠ¶æ€ï¼ˆç»¿è‰²ï¼‰ |
| `--grad-warning` | `#FFC857 â†’ #FFE29F` | è­¦å‘ŠçŠ¶æ€ï¼ˆæ©™é»„è‰²ï¼‰ |
| `--grad-error` | `#FF6B7A â†’ #FF8FA3` | é”™è¯¯çŠ¶æ€ï¼ˆçº¢è‰²ï¼‰ |
| `--grad-info` | `#4ECDC4 â†’ #44A3AA` | ä¿¡æ¯æç¤ºï¼ˆé’ç»¿è‰²ï¼‰ |

**å·¥å…·ä¸çŠ¶æ€æ¸å˜**
| å˜é‡å | é¢œè‰²å€¼ | ç”¨é€” |
|--------|--------|------|
| `--grad-thinking` | `#B794F4 â†’ #9F7AEA` | æ€è€ƒçŠ¶æ€ / **Plan Mode**ï¼ˆç´«è‰²ï¼‰ |
| `--grad-tool` | `#63B3ED â†’ #4299E1` | å·¥å…·è°ƒç”¨ï¼ˆè“è‰²ï¼‰ |

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.1
**æœ€åæ›´æ–°**: 2026-01-11
**å˜æ›´è®°å½•**:
- v2.1: å®Œæˆ Plan Mode è®¾è®¡ï¼ˆç´«è‰²è¾¹æ¡† #B794F4ï¼ŒExitPlanMode ç¡®è®¤å¼¹çª—ï¼‰ï¼Œæ·»åŠ é¢œè‰²ç³»ç»Ÿå‚è€ƒè¡¨
- v2.0: æ¸…ç†å·²ä¿®å¤çš„é—®é¢˜ï¼ˆé—®é¢˜1ã€2ã€4ï¼‰ï¼Œä¿ç•™å¾…è§‚å¯Ÿé—®é¢˜ï¼ˆé—®é¢˜3æ”¹ä¸ºé—®é¢˜1ï¼‰ï¼Œç²¾ç®€æ–‡æ¡£ç»“æ„
- v1.3: é‡æ„æ–‡æ¡£ç»“æ„ï¼Œåˆ†ç¦»"é—®é¢˜ä¿®å¤"å’Œ"åŠŸèƒ½å‡çº§"ä¸¤éƒ¨åˆ†
- v1.2: æ·»åŠ  Context Window è®¡ç®—é—®é¢˜åˆ†æã€æ–°å·¥å…·äº¤äº’è®¾è®¡è¯¦è§£
- v1.1: æ·»åŠ è°ƒè¯•æ–¹æ¡ˆã€Tools åˆ—è¡¨æ›´æ–°ã€æµ‹è¯•ç­–ç•¥
