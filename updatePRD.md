# Claude Code ChatUI 3.0.1 å‡çº§ PRD

> **ç‰ˆæœ¬**: 3.0.1
> **æ—¥æœŸ**: 2026-01-10
> **çŠ¶æ€**: è‰ç¨¿
> **ä½œè€…**: LK & Claude

---

# ç¬¬ä¸€éƒ¨åˆ†ï¼šéœ€è¦è§£å†³çš„é—®é¢˜ï¼ˆä¼˜å…ˆçº§ P0-P1ï¼‰

è¿™äº›æ˜¯å½“å‰ç‰ˆæœ¬å­˜åœ¨çš„ Bug å’Œé—®é¢˜ï¼Œéœ€è¦åœ¨å‡çº§å‰ä¿®å¤ã€‚

---

## é—®é¢˜ 1ï¼šContext Window è®¡ç®—ä¸å‡†ç¡® â­â­â­

### é—®é¢˜æè¿°
- æ˜¾ç¤º"Compact Context Window 60%"
- ç»å¸¸å¡åœ¨ 23% å·¦å³ä¸åŠ¨
- æ•°å€¼ä¸éšå¯¹è¯å¢é•¿è€Œæ­£ç¡®å˜åŒ–

### Anthropic API Token å­—æ®µè¯´æ˜ï¼ˆç» Gemini æœç´¢ç¡®è®¤ï¼‰

**é‡è¦**ï¼šä»¥ä¸‹å››ä¸ªå­—æ®µæ˜¯**äº’æ–¥çš„ã€åˆ†å¼€çš„**ï¼Œä¸æ˜¯åŒ…å«å…³ç³»ï¼

| å­—æ®µ | å«ä¹‰ | ä»·æ ¼ |
|------|------|------|
| `input_tokens` | éç¼“å­˜çš„æ™®é€šè¾“å…¥ï¼ˆé€šå¸¸æ˜¯æ–°æ¶ˆæ¯ï¼‰ | åŸºç¡€è¾“å…¥ä»·æ ¼ |
| `cache_creation_input_tokens` | å†™å…¥ç¼“å­˜çš„ token | è¾“å…¥ä»·æ ¼ Ã— 1.25 |
| `cache_read_input_tokens` | ä»ç¼“å­˜è¯»å–çš„ token | è¾“å…¥ä»·æ ¼ Ã— 0.1 |
| `output_tokens` | æ¨¡å‹è¾“å‡ºçš„ token | è¾“å‡ºä»·æ ¼ |

### å®é™…æ•°æ®éªŒè¯ï¼ˆæ¥è‡ª Claude å®˜æ–¹å¯¹è¯è®°å½• JSONLï¼‰

é€šè¿‡è§£æ `~/.claude/projects/*/xxx.jsonl` æ–‡ä»¶ï¼ŒéªŒè¯äº†è®¡ç®—å…¬å¼ï¼š

| Turn | input | cache_creation | cache_read | output | **TOTAL** | **%** |
|------|-------|----------------|------------|--------|-----------|-------|
| 0 | 2 | 57183 | 29107 | 1049 | 87341 | 43.7% |
| 1 | 2 | 41617 | 0 | 1 | 41620 | 20.8% |
| 3 | 0 | 5327 | 41617 | 1 | 46945 | **23.5%** |
| 8 | 0 | 15042 | 52516 | 11423 | 78981 | 39.5% |

**"å¡åœ¨ 23%" çš„åŸå› è§£é‡Š**ï¼š
- Turn 3 çš„ TOTAL æ˜¯ 46945 = 23.5%
- å½“å‰ä»£ç åªè®¡ç®— `input + cache_read = 0 + 41617 = 41617 (20.8%)`
- é—æ¼äº† `cache_creation (5327)` å’Œ `output (1)`

### å½“å‰ä»£ç çš„é—®é¢˜

**å½“å‰é”™è¯¯çš„è®¡ç®—ä»£ç ** (`src/ui-v2/ui-script.ts` ç¬¬ 2205-2206 è¡Œ)ï¼š
```typescript
// âŒ é”™è¯¯ï¼šåªè®¡ç®—äº† currentInputTokens + cacheReadTokens
// é—æ¼äº† cache_creation_input_tokens å’Œ output_tokensï¼
lastContextTokens = (message.data.currentInputTokens || 0) +
                   (message.data.cacheReadTokens || 0);
```

**ä¸ºä»€ä¹ˆä¼šå¡åœ¨ 23%**ï¼š
- å½“å‰è®¡ç®—ï¼š`input_tokens(2) + cache_read(0) = 2` â†’ å‡ ä¹æ˜¯ 0%
- é—æ¼äº† `cache_creation_input_tokens(41617)`ï¼ˆé€šå¸¸æ˜¯æœ€å¤§çš„éƒ¨åˆ†ï¼ï¼‰
- åç»­è¯·æ±‚å¦‚æœ cache_read å¼€å§‹æœ‰å€¼ï¼Œæ‰ä¼šçœ‹åˆ°ç™¾åˆ†æ¯”å¢é•¿

### æ­£ç¡®çš„è®¡ç®—å…¬å¼

```typescript
// âœ… æ­£ç¡®ï¼šè®¡ç®—æ‰€æœ‰å ç”¨ context window çš„ tokenï¼ˆå››ä¸ªå­—æ®µæ˜¯äº’æ–¥çš„ï¼‰
lastContextTokens = (message.data.currentInputTokens || 0) +      // input_tokens
                   (message.data.cacheCreationTokens || 0) +      // cache_creation_input_tokens
                   (message.data.cacheReadTokens || 0) +          // cache_read_input_tokens
                   (message.data.currentOutputTokens || 0);       // output_tokens
```

### ä¿®å¤æ–‡ä»¶
| æ–‡ä»¶ | è¡Œå· | ä¿®æ”¹å†…å®¹ |
|------|------|----------|
| `src/ui-v2/ui-script.ts` | 2205-2206 | ä¿®å¤ Context Window è®¡ç®—å…¬å¼ |

---

## é—®é¢˜ 2ï¼šToken ç»Ÿè®¡å’Œä»·æ ¼è®¡ç®— âœ… å·²éªŒè¯æ­£ç¡®

### ä»·æ ¼è®¡ç®—ä»£ç åˆ†æ

**å½“å‰ä»£ç ** (`src/providers/ClaudeChatProvider.ts` ç¬¬ 1500-1519 è¡Œ)ï¼š
```typescript
// è®¡ç®—æ™®é€šè¾“å…¥tokençš„æˆæœ¬
const normalInputCost = ((entry.usage.input_tokens || 0) * pricing.input) / 1000000;

// è®¡ç®—ç¼“å­˜è¯»å–tokençš„æˆæœ¬ï¼ˆè¾“å…¥ä»·æ ¼çš„10%ï¼‰âœ… æ­£ç¡®
const cacheReadCost = ((entry.usage.cache_read_input_tokens || 0) * pricing.input * 0.1) / 1000000;

// è®¡ç®—è¾“å‡ºtokençš„æˆæœ¬ âœ… æ­£ç¡®
const outputCost = ((entry.usage.output_tokens || 0) * pricing.output) / 1000000;

// è®¡ç®—ç¼“å­˜åˆ›å»ºtokençš„æˆæœ¬ï¼ˆè¾“å‡ºä»·æ ¼çš„25%ï¼‰
// æ•°å­¦ä¸Šç­‰ä»·äº input_price Ã— 1.25ï¼ˆå½“ output = input Ã— 5 æ—¶ï¼‰
const cacheCreationCost = ((entry.usage.cache_creation_input_tokens || 0) * pricing.output * 0.25) / 1000000;
```

### éªŒè¯è®¡ç®—ï¼ˆä»¥ Sonnet 4.5 ä¸ºä¾‹ï¼‰

| Token ç±»å‹ | å®˜æ–¹ä»·æ ¼ | ä»£ç è®¡ç®— | ç»“æœ |
|-----------|---------|---------|------|
| `input_tokens` | $3.00/M | `3.00` | âœ… |
| `cache_read` | $0.30/M (10%) | `3.00 Ã— 0.1 = 0.30` | âœ… |
| `cache_creation` | $3.75/M (125%) | `15.00 Ã— 0.25 = 3.75` | âœ… |
| `output_tokens` | $15.00/M | `15.00` | âœ… |

**ç»“è®º**ï¼šä»·æ ¼è®¡ç®—ä»£ç æ˜¯æ­£ç¡®çš„ï¼`output Ã— 0.25 = input Ã— 1.25`

---

## é—®é¢˜ 3ï¼šè¾“å…¥åé»„ç¯å˜ç»¿ç¯ä½†æ— è¾“å‡ºï¼ˆå¾…è§‚å¯Ÿï¼‰â­

### é—®é¢˜æè¿°
- è¾“å…¥æç¤ºè¯åï¼Œå·¦ä¸‹è§’ä¼šå˜æˆé»„ç¯ï¼ˆè¡¨ç¤ºå·¥ä½œä¸­ï¼‰
- è¿‡ä¸€ä¼šå°±å˜æˆç»¿ç¯äº†ï¼Œæ²¡æœ‰ä»»ä½•è¾“å‡º
- éœ€è¦é‡æ–°è¾“å…¥æç¤ºè¯æ‰èƒ½å·¥ä½œ

### çŠ¶æ€
**æš‚æ—¶æç½®** - ç­‰åˆ°å†æ¬¡é‡åˆ°æ­¤é—®é¢˜æ—¶ï¼Œé€šè¿‡ debug_log.txt åˆ†æå…·ä½“åŸå› ã€‚

### å·²åˆ†æçš„å¯èƒ½åŸå› 

1. **è¿›ç¨‹æ­£å¸¸é€€å‡ºä½†æ²¡æœ‰è¾“å‡º**ï¼šè¿›ç¨‹ä»¥ code=0 é€€å‡ºä½†æ—  stdout
2. **ç¼ºå°‘è¶…æ—¶æœºåˆ¶**ï¼šå¦‚æœ CLI å¡ä½ï¼Œè¿›ç¨‹ä¼šä¸€ç›´è¿è¡Œ
3. **é”™è¯¯å¤„ç†ä¸å®Œå–„**ï¼šæŸäº›é”™è¯¯æƒ…å†µæ²¡æœ‰å‘ç”¨æˆ·æ˜¾ç¤º

---

## é—®é¢˜ 4ï¼šCompact æŒ‰é’®æœ‰æ—¶ä¸å·¥ä½œï¼ˆæš‚ç¼“ï¼‰â­

### é—®é¢˜æè¿°
- Compact æŒ‰é’®å¤§éƒ¨åˆ†æ—¶å€™å¯ä»¥å·¥ä½œ
- ä½†å¶å°”ä¼šå®Œå…¨ä¸å·¥ä½œï¼Œç­‰åŠå¤©ä¹Ÿæ²¡æœ‰æ€»ç»“
- æŒ‰é’®è®¾è®¡æ—¶åªæœ‰ä¸€å¥è¯æç¤ºï¼Œçœ‹ä¸åˆ°å·¦ä¸‹è§’çš„åŠ¨æ€å˜åŒ–

### çŠ¶æ€
**æš‚ç¼“å¤„ç†** - å…ˆè§£å†³é—®é¢˜ 1ï¼ˆContext Window è®¡ç®—ï¼‰ï¼Œåç»­å†å¤„ç†æ­¤é—®é¢˜ã€‚

---

# ç¬¬äºŒéƒ¨åˆ†ï¼šéœ€è¦å‡çº§çš„åŠŸèƒ½

åœ¨ä¿®å¤ä¸Šè¿°é—®é¢˜åï¼Œç»§ç»­è¿›è¡Œä»¥ä¸‹å‡çº§ã€‚

---

## 1. å‡çº§èƒŒæ™¯

### 1.1 ä¸ºä»€ä¹ˆè¦å‡çº§ï¼Ÿ

Claude Code CLI åœ¨ 2.1.1 å’Œ 2.1.2 ç‰ˆæœ¬ä¸­è¿›è¡Œäº†é‡å¤§æ›´æ–°ï¼Œå¼•å…¥äº†å¤šä¸ªæ–°å·¥å…·å’ŒåŠŸèƒ½ã€‚æˆ‘ä»¬çš„ VS Code æ’ä»¶éœ€è¦è·Ÿè¿›è¿™äº›å˜åŒ–ï¼Œä»¥ï¼š

1. **ä¿æŒå…¼å®¹æ€§**ï¼šæ”¯æŒ Claude CLI çš„æ‰€æœ‰æ–°å·¥å…·
2. **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šåˆ©ç”¨æ–°å·¥å…·æä¾›æ›´å¥½çš„äº¤äº’
3. **ç‰ˆæœ¬å·ç‹¬ç«‹**ï¼šå°†æ’ä»¶ç‰ˆæœ¬ä¸ CLI ç‰ˆæœ¬è§£è€¦ï¼Œä½¿ç”¨ç‹¬ç«‹çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬

### 1.2 æ ¸å¿ƒæ¶æ„è¯´æ˜ï¼ˆé‡è¦ï¼ï¼‰

âš ï¸ **è¿™ä¸æ˜¯ SDK æ¨¡å¼ï¼Œè€Œæ˜¯ CLI åŒ…è£…å™¨æ¨¡å¼ï¼**

```
ç”¨æˆ·è¾“å…¥ â†’ Webview â†’ ClaudeChatProvider
                           â†“
                    ClaudeProcessService
                           â†“
                    spawn('claude', [...args])  â† ç›´æ¥è°ƒç”¨ CLIï¼
                           â†“
                      stdio (stdin/stdout)
                           â†“
                    MessageProcessor è§£æ JSON æµ
                           â†“
                      å‘é€å› Webview
```

**å…³é”®ç‚¹**ï¼š
- æ’ä»¶é€šè¿‡ `child_process.spawn()` å¯åŠ¨ Claude CLI è¿›ç¨‹
- ç”¨æˆ·æ¶ˆæ¯é€šè¿‡ `stdin` å‘é€ç»™ CLI
- CLI å“åº”é€šè¿‡ `stdout` ä»¥ JSON æµå½¢å¼è¿”å›
- `MessageProcessor` è§£æè¿™äº› JSON è¡Œï¼Œæå– `tool_use`ã€`text`ã€`result` ç­‰äº‹ä»¶
- **å·¥å…·ç”± CLI æ‰§è¡Œï¼Œæ’ä»¶åªè´Ÿè´£è§£æå’Œå±•ç¤ºï¼**

**è¿™æ„å‘³ç€**ï¼š
- æ–°å·¥å…·ï¼ˆå¦‚ `TaskOutput`, `KillShell`ï¼‰æ˜¯ CLI è‡ªå·±è°ƒç”¨çš„
- æ’ä»¶åªéœ€è¦è§£æ `tool_use` äº‹ä»¶å¹¶å±•ç¤º
- æŸäº›å·¥å…·ï¼ˆå¦‚ `AskUserQuestion`ï¼‰éœ€è¦æ’ä»¶æä¾› UI äº¤äº’ï¼Œç„¶åæŠŠç»“æœå‘å› CLI

### 1.3 ç‰ˆæœ¬å·å˜æ›´

| ç»„ä»¶ | æ—§ç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ | è¯´æ˜ |
|------|--------|--------|------|
| VS Code æ’ä»¶ | 2.1.3 | **3.0.1** | å¤§ç‰ˆæœ¬å‡çº§ï¼Œç‹¬ç«‹äº CLI ç‰ˆæœ¬ |
| Claude Code CLI | 2.1.2 | 2.1.2 | ä¿æŒå…¼å®¹ |

---

## 2. Claude Code CLI 2.1.2 æ–°å·¥å…·ä½“ç³»

### 2.1 å†…ç½®å·¥å…·æ¸…å•ï¼ˆ17ä¸ªï¼‰

```
æ ¸å¿ƒå·¥å…·:
â”œâ”€â”€ Task          - å¯åŠ¨å­ä»£ç†å¤„ç†å¤æ‚ä»»åŠ¡
â”œâ”€â”€ TaskOutput    - ğŸ†• è·å–æ­£åœ¨è¿è¡Œ/å·²å®Œæˆä»»åŠ¡çš„è¾“å‡º
â”œâ”€â”€ Bash          - æ‰§è¡Œ bash å‘½ä»¤
â”œâ”€â”€ KillShell     - ğŸ†• ç»ˆæ­¢åå°è¿è¡Œçš„ shell
â”œâ”€â”€ Glob          - æ–‡ä»¶æ¨¡å¼åŒ¹é…
â”œâ”€â”€ Grep          - åŸºäº ripgrep çš„æœç´¢
â”œâ”€â”€ Read          - è¯»å–æ–‡ä»¶
â”œâ”€â”€ Edit          - ç¼–è¾‘æ–‡ä»¶
â”œâ”€â”€ Write         - å†™å…¥æ–‡ä»¶
â”œâ”€â”€ NotebookEdit  - ç¼–è¾‘ Jupyter notebook
â”œâ”€â”€ WebFetch      - è·å–ç½‘é¡µå†…å®¹
â”œâ”€â”€ WebSearch     - ç½‘ç»œæœç´¢
â”œâ”€â”€ TodoWrite     - ä»»åŠ¡åˆ—è¡¨ç®¡ç†
â”œâ”€â”€ AskUserQuestion - ğŸ†• å‘ç”¨æˆ·æé—®
â”œâ”€â”€ Skill         - ğŸ†• æ‰§è¡ŒæŠ€èƒ½/æ–œæ å‘½ä»¤
â”œâ”€â”€ EnterPlanMode - ğŸ†• è¿›å…¥è®¡åˆ’æ¨¡å¼
â””â”€â”€ ExitPlanMode  - ğŸ†• é€€å‡ºè®¡åˆ’æ¨¡å¼
```

### 2.2 æ–°å¢å·¥å…·è¯¦ç»†è¯´æ˜ï¼ˆåŸºäº CLI åŒ…è£…å™¨æ¨¡å¼ï¼‰

> âš ï¸ **é‡è¦**ï¼šè¿™äº›å·¥å…·éƒ½æ˜¯ Claude CLI è‡ªå·±è°ƒç”¨çš„ï¼Œæ’ä»¶åªéœ€è¦è§£æå’Œå±•ç¤ºã€‚
> åªæœ‰ `AskUserQuestion` éœ€è¦æ’ä»¶æä¾›äº¤äº’ UIã€‚

#### 2.2.1 TaskOutput
- **ç”¨é€”**ï¼šè·å–åå°è¿è¡Œä»»åŠ¡çš„è¾“å‡º
- **åœºæ™¯**ï¼šClaude åœ¨ç­‰å¾… subagent å®Œæˆæ—¶æŸ¥è¯¢è¿›åº¦
- **å‚æ•°**ï¼š`task_id`, `block`, `timeout`
- **æ’ä»¶éœ€è¦åšçš„**ï¼š
  - è§£æ `tool_use` äº‹ä»¶ï¼Œè¯†åˆ« `TaskOutput` å·¥å…·
  - åœ¨ UI ä¸­æ˜¾ç¤º subagent çŠ¶æ€ï¼ˆå¯é€‰ï¼šæŠ˜å é¢æ¿ï¼‰
  - **ä¸éœ€è¦**å®ç°å·¥å…·é€»è¾‘ï¼ŒCLI ä¼šè‡ªå·±å¤„ç†

#### 2.2.2 KillShell
- **ç”¨é€”**ï¼šç»ˆæ­¢åå°è¿è¡Œçš„ shell è¿›ç¨‹
- **åœºæ™¯**ï¼šClaude éœ€è¦åœæ­¢ä¸€ä¸ªè¶…æ—¶æˆ–ä¸éœ€è¦çš„åå°ä»»åŠ¡
- **å‚æ•°**ï¼š`shell_id`
- **æ’ä»¶éœ€è¦åšçš„**ï¼š
  - è§£æ `tool_use` äº‹ä»¶
  - åœ¨ UI ä¸­æ˜¾ç¤º"ç»ˆæ­¢è¿›ç¨‹"çŠ¶æ€
  - **æ½œåœ¨é£é™©**ï¼šCLI è°ƒç”¨å¯èƒ½è¯¯æ€ï¼Œä½†è¿™æ˜¯ CLI çš„è¡Œä¸ºï¼Œæ’ä»¶æ— æ³•æ§åˆ¶
  - **ä¸éœ€è¦**å®ç°æ€è¿›ç¨‹é€»è¾‘

#### 2.2.3 AskUserQuestion ğŸ”´ é‡ç‚¹
- **ç”¨é€”**ï¼šClaude éœ€è¦å‘ç”¨æˆ·æé—®å¹¶è·å–é€‰æ‹©
- **åœºæ™¯**ï¼šéœ€è¦ç”¨æˆ·ç¡®è®¤æˆ–é€‰æ‹©æ—¶ï¼ˆå¦‚é€‰æ‹©è®¤è¯æ–¹å¼ï¼‰
- **å‚æ•°**ï¼š
  ```typescript
  {
    questions: [{
      question: string,      // é—®é¢˜å†…å®¹
      header: string,        // æ ‡ç­¾ï¼ˆæœ€å¤š12å­—ç¬¦ï¼‰
      options: [{
        label: string,       // é€‰é¡¹æ˜¾ç¤ºæ–‡æœ¬
        description: string  // é€‰é¡¹æè¿°
      }],
      multiSelect: boolean   // æ˜¯å¦å¤šé€‰
    }]
  }
  ```
- **æ’ä»¶éœ€è¦åšçš„**ï¼š
  1. è§£æ `tool_use` äº‹ä»¶ï¼Œè¯†åˆ« `AskUserQuestion`
  2. **åœ¨ UI ä¸­æ¸²æŸ“é€‰é¡¹è¡¨å•**ï¼ˆå•é€‰/å¤šé€‰ï¼‰
  3. ç”¨æˆ·é€‰æ‹©åï¼Œ**å°†ç»“æœä½œä¸º tool_result å‘å› CLI stdin**
  4. è¿™æ˜¯**å”¯ä¸€éœ€è¦åŒå‘äº¤äº’**çš„å·¥å…·

#### 2.2.4 Skill
- **ç”¨é€”**ï¼šæ‰§è¡Œé¢„å®šä¹‰çš„æŠ€èƒ½ï¼ˆæ–œæ å‘½ä»¤ï¼‰
- **åœºæ™¯**ï¼šClaude å†³å®šè°ƒç”¨æŸä¸ªæŠ€èƒ½
- **å‚æ•°**ï¼š`skill`, `args`
- **æ’ä»¶éœ€è¦åšçš„**ï¼š
  - è§£æ `tool_use` äº‹ä»¶
  - åœ¨ UI ä¸­æ˜¾ç¤º"æ‰§è¡ŒæŠ€èƒ½: xxx"
  - **å¯é€‰**ï¼šæä¾›æ–œæ å‘½ä»¤è‡ªåŠ¨è¡¥å…¨ï¼ˆè¾“å…¥æ¡†åŠŸèƒ½ï¼‰
  - **ä¸éœ€è¦**å®ç°æŠ€èƒ½é€»è¾‘ï¼ŒCLI ä¼šå¤„ç†

#### 2.2.5 EnterPlanMode / ExitPlanMode
- **ç”¨é€”**ï¼šClaude è‡ªä¸»åˆ‡æ¢è®¡åˆ’æ¨¡å¼
- **åœºæ™¯**ï¼šClaude è®¤ä¸ºéœ€è¦å…ˆè§„åˆ’å†æ‰§è¡Œ
- **æ—§å®ç°**ï¼šç”¨æˆ·ç‚¹å‡»å¼€å…³ â†’ æ¶ˆæ¯å‰ç¼€ `PLAN FIRST...`
- **æ–°å®ç°**ï¼šClaude è‡ªå·±è°ƒç”¨å·¥å…·
- **æ’ä»¶éœ€è¦åšçš„**ï¼š
  - è§£æ `tool_use` äº‹ä»¶
  - å½“æ£€æµ‹åˆ° `EnterPlanMode` æ—¶ï¼Œæ›´æ–° UI çŠ¶æ€ï¼ˆå¦‚è¾¹æ¡†å˜è“ï¼‰
  - å½“æ£€æµ‹åˆ° `ExitPlanMode` æ—¶ï¼Œæ¢å¤ UI çŠ¶æ€
  - **å¯é€‰**ï¼šä¿ç•™ç”¨æˆ·æ‰‹åŠ¨è§¦å‘ï¼ˆä½œä¸ºæç¤º hintï¼‰

---

## 3. åŠŸèƒ½å˜æ›´æ¸…å•

### 3.1 ç§»é™¤åŠŸèƒ½

#### 3.1.1 æ“ä½œæŒ‰é’®ï¼ˆOperation History Buttonï¼‰
- **ä½ç½®**ï¼šå³ä¸Šè§’ç¬¬ä¸‰ä¸ªæŒ‰é’® ğŸ”„
- **å½“å‰åŠŸèƒ½**ï¼šæ‰“å¼€æ“ä½œå†å²é¢æ¿ï¼Œæ”¯æŒæ’¤é”€/é‡åš
- **ç§»é™¤åŸå› **ï¼š
  1. ä½¿ç”¨é¢‘ç‡ä½
  2. å ç”¨å®è´µçš„ header ç©ºé—´
  3. åŠŸèƒ½å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼è®¿é—®
- **æ›¿ä»£æ–¹æ¡ˆ**ï¼š
  - å¿«æ·é”® `Ctrl+Z` / `Ctrl+Shift+Z`
  - å‘½ä»¤é¢æ¿ `Claude Code: Undo Last Operation`
  - è®¾ç½®é¢æ¿ä¸­æ·»åŠ æ“ä½œå†å²å…¥å£

### 3.2 æ–°å¢åŠŸèƒ½

#### 3.2.1 AskUserQuestion UI ç»„ä»¶
**è®¾è®¡æ–¹æ¡ˆ**ï¼šå†…è”äº¤äº’è¡¨å•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤” Claude éœ€è¦ä½ çš„é€‰æ‹©                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Which authentication method should we use?         â”‚
â”‚                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ â—‹ JWT (Recommended)                          â”‚   â”‚
â”‚ â”‚   Stateless, scalable, good for microservicesâ”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ â—‹ Session-based                              â”‚   â”‚
â”‚ â”‚   Traditional, simple, server-side storage   â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ â—‹ OAuth 2.0                                  â”‚   â”‚
â”‚ â”‚   Third-party authentication, social login   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                    â”‚
â”‚ [Other (Custom input)]                [Submit]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°è¦ç‚¹**ï¼š
- åœ¨èŠå¤©æµä¸­å†…è”æ˜¾ç¤º
- æ”¯æŒå•é€‰å’Œå¤šé€‰æ¨¡å¼
- é€‰æ‹©åé”å®šï¼Œé˜²æ­¢é‡å¤æäº¤
- æ”¯æŒ "Other" è‡ªå®šä¹‰è¾“å…¥
- å“åº”å¼è®¾è®¡ï¼Œé€‚åº”ä¸åŒå®½åº¦

#### 3.2.2 Skill è‡ªåŠ¨è¡¥å…¨èœå•
**è®¾è®¡æ–¹æ¡ˆ**ï¼šè¾“å…¥ `/` æ—¶è§¦å‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å…¥æ¡†: /com                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¯ Matching Skills                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ /commit                         â”‚ â”‚
â”‚ â”‚   Create a git commit           â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ /compact                        â”‚ â”‚
â”‚ â”‚   Compact conversation context  â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ /component-scaffold             â”‚ â”‚
â”‚ â”‚   Scaffold a new component      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°è¦ç‚¹**ï¼š
- å®æ—¶è¿‡æ»¤åŒ¹é…
- æ˜¾ç¤ºæŠ€èƒ½æè¿°
- æŒ‰åˆ†ç±»ç»„ç»‡
- é”®ç›˜å¯¼èˆªæ”¯æŒï¼ˆâ†‘â†“ Enterï¼‰
- Tab è¡¥å…¨

#### 3.2.3 Plan Mode å·¥å…·é©±åŠ¨é€‚é…
**è®¾è®¡æ–¹æ¡ˆ**ï¼šå“åº”å¼çŠ¶æ€åŒæ­¥

**æ—§é€»è¾‘**ï¼š
```
ç”¨æˆ·ç‚¹å‡» Plan First å¼€å…³ â†’ æ¶ˆæ¯å‰ç¼€æ·»åŠ  â†’ å‘é€ç»™ Claude
```

**æ–°é€»è¾‘**ï¼š
```
ç”¨æˆ·å‘é€æ¶ˆæ¯ â†’ Claude å†³å®šæ˜¯å¦è°ƒç”¨ EnterPlanMode
â†’ UI æ”¶åˆ° tool_use äº‹ä»¶ â†’ è‡ªåŠ¨åˆ‡æ¢ Plan Mode çŠ¶æ€æ˜¾ç¤º
â†’ Claude è°ƒç”¨ ExitPlanMode â†’ UI æ¢å¤æ­£å¸¸çŠ¶æ€
```

**UI å˜åŒ–**ï¼š
- Plan First å¼€å…³å˜ä¸º**åªè¯»çŠ¶æ€æŒ‡ç¤ºå™¨**
- å½“ Claude è¿›å…¥ Plan Mode æ—¶ï¼š
  - è¾¹æ¡†é¢œè‰²å˜åŒ–ï¼ˆè“è‰²ï¼‰
  - æ˜¾ç¤º "ğŸ“‹ Planning..." çŠ¶æ€
- ä¿ç•™æ‰‹åŠ¨è§¦å‘é€‰é¡¹ï¼ˆå‘é€æ—¶æºå¸¦ hintï¼‰

#### 3.2.4 KillShell è‡ªåŠ¨æ¸…ç†
**è®¾è®¡æ–¹æ¡ˆ**ï¼šè‡ªåŠ¨ + æ‰‹åŠ¨

- **è‡ªåŠ¨æ¸…ç†**ï¼š
  - ç‚¹å‡» "Stop" æŒ‰é’®æ—¶ç»ˆæ­¢æ‰€æœ‰åå° shell
  - æ’ä»¶åœç”¨æ—¶æ¸…ç†æ‰€æœ‰è¿›ç¨‹
  - ä¼šè¯ç»“æŸæ—¶æ¸…ç†

- **æ‰‹åŠ¨æ¸…ç†**ï¼š
  - åœ¨ subagent è¾“å‡ºåŒºåŸŸæ·»åŠ  "ç»ˆæ­¢" æŒ‰é’®
  - å‘½ä»¤é¢æ¿ `Claude Code: Kill Background Tasks`

#### 3.2.5 TaskOutput æŠ˜å æ˜¾ç¤º
**è®¾è®¡æ–¹æ¡ˆ**ï¼šå¯æŠ˜å çš„ subagent æ—¥å¿—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¶ Subagent: Explore (task-abc123)        [Running] â”‚
â”‚   Searching for files matching "*.ts"...           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¼ Subagent: Code Review (task-def456)   [Complete] â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Reviewed 5 files                           â”‚   â”‚
â”‚   â”‚ Found 2 issues:                            â”‚   â”‚
â”‚   â”‚ - src/index.ts:42 - Missing error handling â”‚   â”‚
â”‚   â”‚ - src/utils.ts:15 - Unused import          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Skill ç®¡ç†ç³»ç»Ÿ

### 4.1 Skills æ¦‚è§ˆ
ä» Claude CLI 2.1.2 ä¸­è·å–çš„æŠ€èƒ½åˆ†ä¸ºä»¥ä¸‹ç±»åˆ«ï¼š

| ç±»åˆ« | æŠ€èƒ½æ•°é‡ | ç¤ºä¾‹ |
|------|----------|------|
| backend-development | 3 | api-design-principles, architecture-patterns |
| cloud-infrastructure | 4 | cost-optimization, terraform-module-library |
| python-development | 5 | async-python-patterns, uv-package-manager |
| javascript-typescript | 4 | modern-javascript-patterns, typescript-advanced-types |
| **é€šç”¨** | 8 | compact, context, cost, init, pr-comments, etc. |

### 4.2 Skill ç®¡ç†ç•Œé¢è®¾è®¡

**å…¥å£**ï¼šè¾“å…¥æ¡†å·¦ä¾§çš„ "Skills" æŒ‰é’®ï¼ˆç±»ä¼¼ç°æœ‰çš„ Tools æŒ‰é’®ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Skills                                         [âœ•]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Search skills...                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â­ Favorites                                         â”‚
â”‚   /commit          Create a git commit              â”‚
â”‚   /review          Review code changes              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ backend-development                              â”‚
â”‚   /api-design-principles    REST/GraphQL design     â”‚
â”‚   /architecture-patterns    Clean/Hexagonal arch    â”‚
â”‚   /microservices-patterns   Service boundaries      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ cloud-infrastructure                             â”‚
â”‚   /cost-optimization        Cloud cost reduction    â”‚
â”‚   /terraform-module-library Reusable IaC modules    â”‚
â”‚   ...                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ python-development                               â”‚
â”‚   /async-python-patterns    asyncio/await patterns  â”‚
â”‚   /python-packaging         PyPI distribution       â”‚
â”‚   ...                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Skill ä½¿ç”¨æ–¹å¼

1. **æ–œæ å‘½ä»¤**ï¼šåœ¨è¾“å…¥æ¡†è¾“å…¥ `/skill-name`
2. **è‡ªåŠ¨è¡¥å…¨**ï¼šè¾“å…¥ `/` åæ˜¾ç¤ºå€™é€‰åˆ—è¡¨
3. **ç®¡ç†é¢æ¿**ï¼šç‚¹å‡»ç›´æ¥æ’å…¥åˆ°è¾“å…¥æ¡†
4. **æ”¶è—åŠŸèƒ½**ï¼šå¸¸ç”¨æŠ€èƒ½å¿«é€Ÿè®¿é—®

---

## 5. SubAgent ç®¡ç†ç³»ç»Ÿï¼ˆè¯„ä¼°ä¸­ï¼‰

### 5.1 æ˜¯å¦éœ€è¦ SubAgent ç®¡ç†ï¼Ÿ

**å½“å‰çŠ¶æ€**ï¼š
- Claude CLI æ”¯æŒ 36 ç§ subagent ç±»å‹
- é€šè¿‡ Task å·¥å…·è‡ªåŠ¨è°ƒç”¨
- ç”¨æˆ·æ— æ³•ç›´æ¥æ§åˆ¶

**å¯èƒ½çš„ç®¡ç†åŠŸèƒ½**ï¼š

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | å¿…è¦æ€§ |
|------|--------|--------|
| æŸ¥çœ‹å¯ç”¨ subagent åˆ—è¡¨ | ä½ | å¯é€‰ |
| æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ subagent | ä¸­ | æœ‰ç”¨ |
| ç»ˆæ­¢æŒ‡å®š subagent | ä¸­ | æœ‰ç”¨ |
| é…ç½® subagent åå¥½ | ä½ | å¯é€‰ |

### 5.2 å»ºè®®æ–¹æ¡ˆ

**Phase 1ï¼ˆ3.0.1ï¼‰**ï¼š
- ä¸å®ç°ç‹¬ç«‹çš„ SubAgent ç®¡ç†ç•Œé¢
- åœ¨ TaskOutput æ˜¾ç¤ºä¸­æ·»åŠ  subagent ä¿¡æ¯
- æ”¯æŒé€šè¿‡ KillShell ç»ˆæ­¢åå°ä»»åŠ¡

**Phase 2ï¼ˆåç»­ç‰ˆæœ¬ï¼‰**ï¼š
- å¦‚æœç”¨æˆ·æœ‰éœ€æ±‚ï¼Œæ·»åŠ  SubAgent é¢æ¿
- æ˜¾ç¤ºè¿è¡Œä¸­çš„ subagent åˆ—è¡¨
- æ”¯æŒæŸ¥çœ‹ subagent è¯¦ç»†è¾“å‡º

---

## 6. UI å¸ƒå±€è°ƒæ•´

### 6.1 Header åŒºåŸŸ

**å½“å‰ï¼ˆ2.1.3ï¼‰**ï¼š
```
[Claude Code Chat v2.1.3]                    [âš™ï¸] [ğŸ“ˆ] [ğŸ”„] [ğŸ“œ] [New Chat]
                                             è®¾ç½®  ç»Ÿè®¡  æ“ä½œ  å†å²
```

**æ–°ç‰ˆï¼ˆ3.0.1ï¼‰**ï¼š
```
[Claude Code Chat v3.0.1]                    [âš™ï¸] [ğŸ“ˆ] [ğŸ“œ] [New Chat]
                                             è®¾ç½®  ç»Ÿè®¡  å†å²
```

### 6.2 è¾“å…¥åŒºåŸŸ

**å½“å‰**ï¼š
```
[Plan First] [Thinking Mode] [Language Mode]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type your message...                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Model â–¼] [Mode â–¼] [Tools â–¼] [Plugins â–¼]     [Send] [â¬œ]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ–°ç‰ˆ**ï¼š
```
[Plan First ğŸ“‹] [Thinking Mode] [Language Mode]  â† Plan First å˜ä¸ºçŠ¶æ€æŒ‡ç¤ºå™¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type your message... (Type / for skills)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Model â–¼] [Mode â–¼] [Tools â–¼] [Skills â–¼] [Plugins â–¼] [Send] [â¬œ]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†‘ æ–°å¢ Skills æŒ‰é’®
```

### 6.3 èŠå¤©åŒºåŸŸæ–°å¢ç»„ä»¶

1. **AskUserQuestion è¡¨å•**ï¼šå†…è”åœ¨æ¶ˆæ¯æµä¸­
2. **TaskOutput æŠ˜å é¢æ¿**ï¼šsubagent è¾“å‡º
3. **Plan Mode çŠ¶æ€æŒ‡ç¤ºå™¨**ï¼šè¾¹æ¡†é¢œè‰²å˜åŒ–

---

## 7. æŠ€æœ¯å®ç°è®¡åˆ’

### 7.1 éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | ä¼˜å…ˆçº§ |
|------|----------|--------|
| `package.json` | ç‰ˆæœ¬å· â†’ 3.0.1 | P0 |
| `getBodyContent.ts` | ç§»é™¤æ“ä½œæŒ‰é’®ï¼Œæ·»åŠ  Skills æŒ‰é’® | P0 |
| `ui-script.ts` | AskUserQuestion UIï¼ŒSkill è¡¥å…¨ï¼ŒPlan Mode çŠ¶æ€ | P0 |
| `MessageProcessor.ts` | å¤„ç†æ–°å·¥å…·ç±»å‹ | P0 |
| `ClaudeChatProvider.ts` | æ–°å·¥å…·åç«¯é€»è¾‘ | P0 |
| `styles/features/*.ts` | æ–°ç»„ä»¶æ ·å¼ | P1 |
| `types/index.ts` | æ–°ç±»å‹å®šä¹‰ | P1 |

### 7.2 æ–°å¢æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `ui-v2/components/AskUserQuestion.ts` | AskUserQuestion UI ç»„ä»¶ |
| `ui-v2/components/SkillSelector.ts` | Skill é€‰æ‹©å™¨ç»„ä»¶ |
| `ui-v2/components/TaskOutputPanel.ts` | TaskOutput æŠ˜å é¢æ¿ |
| `managers/SkillManager.ts` | Skill ç®¡ç†é€»è¾‘ |

### 7.3 å®ç°ä¼˜å…ˆçº§

```
Phase 0: Bug ä¿®å¤ï¼ˆç¬¬ä¸€éƒ¨åˆ†ï¼‰
â”œâ”€â”€ é—®é¢˜ 1ï¼šContext Window è®¡ç®—
â”œâ”€â”€ é—®é¢˜ 2ï¼šä»·æ ¼è®¡ç®—
â”œâ”€â”€ é—®é¢˜ 3ï¼šé™é»˜å¤±è´¥å¤„ç†
â””â”€â”€ é—®é¢˜ 4ï¼šCompact æŒ‰é’®

Phase 1: åŸºç¡€å‡çº§
â”œâ”€â”€ ç‰ˆæœ¬å·æ›´æ–°
â”œâ”€â”€ ç§»é™¤æ“ä½œæŒ‰é’®
â””â”€â”€ æ›´æ–° MessageProcessor æ”¯æŒæ–°å·¥å…·

Phase 2: AskUserQuestion
â”œâ”€â”€ UI ç»„ä»¶è®¾è®¡
â”œâ”€â”€ æ¶ˆæ¯å¤„ç†
â””â”€â”€ å“åº”æäº¤

Phase 3: Skill ç³»ç»Ÿ
â”œâ”€â”€ æ–œæ å‘½ä»¤è‡ªåŠ¨è¡¥å…¨
â”œâ”€â”€ Skill ç®¡ç†é¢æ¿
â””â”€â”€ æ”¶è—åŠŸèƒ½

Phase 4: Plan Mode é€‚é…
â”œâ”€â”€ çŠ¶æ€æŒ‡ç¤ºå™¨
â”œâ”€â”€ å·¥å…·é©±åŠ¨é€»è¾‘
â””â”€â”€ è¾¹æ¡†é¢œè‰²å˜åŒ–

Phase 5: KillShell + TaskOutput
â”œâ”€â”€ è‡ªåŠ¨æ¸…ç†é€»è¾‘
â”œâ”€â”€ æŠ˜å é¢æ¿ UI
â””â”€â”€ ç»ˆæ­¢æŒ‰é’®
```

---

## 8. æµ‹è¯•è®¡åˆ’

### 8.1 åŠŸèƒ½æµ‹è¯•

| æµ‹è¯•é¡¹ | éªŒè¯å†…å®¹ |
|--------|----------|
| AskUserQuestion | å•é€‰ã€å¤šé€‰ã€è‡ªå®šä¹‰è¾“å…¥ã€æäº¤ |
| Skill | è‡ªåŠ¨è¡¥å…¨ã€ç®¡ç†é¢æ¿ã€æ‰§è¡Œ |
| Plan Mode | çŠ¶æ€åŒæ­¥ã€è¾¹æ¡†å˜åŒ– |
| KillShell | ç»ˆæ­¢åå°ä»»åŠ¡ã€èµ„æºæ¸…ç† |
| TaskOutput | æŠ˜å /å±•å¼€ã€æµå¼æ›´æ–° |

### 8.2 å…¼å®¹æ€§æµ‹è¯•

- [ ] Claude CLI 2.1.2
- [ ] VS Code 1.85+
- [ ] Windows 10/11
- [ ] macOS (å¯é€‰)

### 8.3 æ€§èƒ½æµ‹è¯•

- [ ] å¤§é‡ TaskOutput ä¸å½±å“ UI å“åº”
- [ ] Skill åˆ—è¡¨åŠ è½½é€Ÿåº¦
- [ ] å†…å­˜å ç”¨ç›‘æ§

---

## 9. é£é™©å’Œç¼“è§£æªæ–½

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| CLI ç‰ˆæœ¬ä¸å…¼å®¹ | é«˜ | ç‰ˆæœ¬æ£€æµ‹ï¼Œé™çº§å¤„ç† |
| UI ç»„ä»¶æ€§èƒ½é—®é¢˜ | ä¸­ | è™šæ‹Ÿåˆ—è¡¨ï¼Œæ‡’åŠ è½½ |
| ç”¨æˆ·ä¹ æƒ¯æ”¹å˜ | ä¸­ | æ¸è¿›å¼æ›´æ–°ï¼Œä¿ç•™å¿«æ·é”® |

---

## 10. åç»­è¿­ä»£ï¼ˆ3.0.2+ï¼‰

- SubAgent ç®¡ç†é¢æ¿
- Skill æ”¶è—åŒæ­¥
- è‡ªå®šä¹‰ Skill æ”¯æŒ
- æ›´å¤šå·¥å…·çš„ UI ä¼˜åŒ–

---

## é™„å½•

### A. Claude CLI å·¥å…·å®Œæ•´åˆ—è¡¨

```
å†…ç½®å·¥å…· (17):
Task, TaskOutput, Bash, KillShell, Glob, Grep, Read, Edit, Write,
NotebookEdit, WebFetch, WebSearch, TodoWrite, AskUserQuestion,
Skill, EnterPlanMode, ExitPlanMode

MCP å·¥å…· (å–å†³äºé…ç½®):
mcp__context7__*, mcp__gemini-assistant__*, mcp__playwright__*, ...

Plugin Agents (36):
Bash, general-purpose, Explore, Plan, code-documentation:*,
debugging-toolkit:*, backend-development:*, frontend-mobile-development:*,
full-stack-orchestration:*, unit-testing:*, code-review-ai:*,
cloud-infrastructure:*, incident-response:*, python-development:*,
javascript-typescript:*
```

### B. å‚è€ƒèµ„æ–™

- [Claude Code CLI Changelog](https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md)
- [VS Code Extension API](https://code.visualstudio.com/api)
- [Webview API](https://code.visualstudio.com/api/extension-guides/webview)

---

## 11. è°ƒè¯•æ–¹æ¡ˆ

### 11.1 å½“å‰çŠ¶æ€

âœ… **å·²å®Œæˆ**ï¼š
- DebugLogger ç³»ç»Ÿå·²å®ç°
- æ”¯æŒé€šè¿‡è®¾ç½® `claudeCodeChatUI.debug.enabled: true` å¯ç”¨
- è‡ªåŠ¨å†™å…¥ `{workspacePath}/debug_log.txt`
- æ»šåŠ¨å¤‡ä»½åŠŸèƒ½ï¼ˆå¯åŠ¨æ—¶æ—§æ—¥å¿— â†’ `debug_log.bak`ï¼‰

### 11.2 ä½¿ç”¨æ–¹æ³•

**æ–¹æ³• 1ï¼šVS Code è®¾ç½®**
1. æŒ‰ `Ctrl + ,` æ‰“å¼€è®¾ç½®
2. æœç´¢ `claudeCodeChatUI.debug`
3. å‹¾é€‰ **"Debug: Enabled"**

**æ–¹æ³• 2ï¼šsettings.json**
```json
{
    "claudeCodeChatUI.debug.enabled": true
}
```

**æ–¹æ³• 3ï¼šå·¥ä½œåŒºè®¾ç½®**
åœ¨é¡¹ç›® `.vscode/settings.json` ä¸­æ·»åŠ ï¼š
```json
{
    "claudeCodeChatUI.debug.enabled": true
}
```

### 11.3 æ—¥å¿—æ–‡ä»¶

| æ–‡ä»¶ | å†…å®¹ |
|------|------|
| `debug_log.txt` | å½“å‰ä¼šè¯çš„æ—¥å¿— |
| `debug_log.bak` | ä¸Šä¸€æ¬¡ä¼šè¯çš„æ—¥å¿—ï¼ˆå¤‡ä»½ï¼‰ |

---

## 12. Tools åˆ—è¡¨æ›´æ–°

### 12.1 éœ€è¦æ·»åŠ çš„å·¥å…·

| å·¥å…·å | æè¿° | å›¾æ ‡ |
|--------|------|------|
| TaskOutput | Get output from running/completed tasks | ğŸ“¤ |
| KillShell | Kill background shell | ğŸ”ª |
| AskUserQuestion | Ask user for input | â“ |
| Skill | Execute skills/slash commands | âš¡ |
| EnterPlanMode | Enter planning mode | ğŸ“‹ |

### 12.2 éœ€è¦ç§»é™¤çš„å·¥å…·

| å·¥å…·å | åŸå›  |
|--------|------|
| LS | å·²è¢« Glob æ›¿ä»£ |

### 12.3 å·¥å…·åˆ—è¡¨æ¥æº

å·¥å…·åˆ—è¡¨å¯ä»¥ä» `system.init` æ¶ˆæ¯ä¸­åŠ¨æ€è·å–ï¼š
```typescript
interface SystemInitMessage {
  tools: string[];  // æ‰€æœ‰å¯ç”¨å·¥å…·
  // ...
}
```

**å»ºè®®**ï¼šæ”¹ä¸ºåŠ¨æ€è·å–ï¼Œè€Œéç¡¬ç¼–ç ã€‚

---

## 13. é—æ¼çš„è€ƒè™‘ç‚¹

### 13.1 CLI ç‰ˆæœ¬å…¼å®¹æ€§

- æ’ä»¶å¯åŠ¨æ—¶åº”æ£€æŸ¥ `claude --version`
- å¦‚æœä½äº 2.1.2ï¼Œæ˜¾ç¤ºè­¦å‘Šæˆ–ç¦ç”¨æ–°ç‰¹æ€§

### 13.2 Thinking Block å±•ç¤º

- Claude 3.7+ æ”¯æŒ extended thinking
- éœ€è¦æ·»åŠ  "Thought Process" æŠ˜å å—
- é»˜è®¤æ”¶èµ·ï¼Œç‚¹å‡»å¯æŸ¥çœ‹æ¨¡å‹çš„æ€è€ƒè¿‡ç¨‹

### 13.3 AskUserQuestion è¶…æ—¶å¤„ç†

- å¦‚æœç”¨æˆ·é•¿æ—¶é—´ä¸å“åº”ï¼ŒCLI å¯èƒ½ä¼šè¶…æ—¶
- éœ€è¦æ˜¾ç¤ºå€’è®¡æ—¶æˆ–æä¾› "Skip/Cancel" æŒ‰é’®

### 13.4 KillShell å®‰å…¨æ€§

- å¿…é¡»æ ¡éªŒ PID å½’å±
- ç¡®ä¿åªç»ˆæ­¢ Claude CLI çš„å­è¿›ç¨‹
- ä¸èƒ½è¯¯æ€ VS Code æˆ–å…¶ä»–æ— å…³è¿›ç¨‹

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.3
**æœ€åæ›´æ–°**: 2026-01-10
**å˜æ›´è®°å½•**:
- v1.3: é‡æ„æ–‡æ¡£ç»“æ„ï¼Œåˆ†ç¦»"é—®é¢˜ä¿®å¤"å’Œ"åŠŸèƒ½å‡çº§"ä¸¤éƒ¨åˆ†ï¼Œæ·»åŠ è¯¦ç»†çš„é—®é¢˜åˆ†æå’Œä¿®å¤æ–¹æ¡ˆ
- v1.2: æ·»åŠ  Context Window è®¡ç®—é—®é¢˜åˆ†æã€æ–°å·¥å…·äº¤äº’è®¾è®¡è¯¦è§£ã€é—æ¼è€ƒè™‘ç‚¹
- v1.1: æ·»åŠ è°ƒè¯•æ–¹æ¡ˆã€Tools åˆ—è¡¨æ›´æ–°ã€æµ‹è¯•ç­–ç•¥
